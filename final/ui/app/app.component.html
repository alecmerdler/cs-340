<md-content>
    <md-toolbar class="md-hue-2">
        <div class="md-toolbar-tools">
            <div flex layout="row">
                <span style="cursor: pointer;" ng-click="$ctrl.currentView.next('list')">TubeRoom</span>
            </div>
            <div ng-if="!$ctrl.currentUser">
                <md-button ng-click="$ctrl.currentView.next('login')">Login</md-button>
            </div>
            <div ng-if="$ctrl.currentUser">
                <span>{{ $ctrl.currentUser.firstName }}</span>
                <md-button ng-click="$ctrl.logout()">Logout</md-button>
            </div>
        </div>
    </md-toolbar>

    <!-- Login View -->
    <div layout="row" layout-align="center"
         ng-if="$ctrl.currentView.getValue() === 'login' || $ctrl.currentView.getValue() === 'signup'">
        <div flex="33">
            <md-card>
                <md-card-content style="padding: 0;">
                    <md-tabs md-dynamic-height>
                        <md-tab label="Login">
                            <form name="$ctrl.loginForm"
                                  layout="column">
                                <div layout="column" layout-align="center center">
                                    <md-input-container flex="50">
                                        <label>Username</label>
                                        <input name="username"
                                               type="text"
                                               ng-model="$ctrl.loginData.username"
                                               required>
                                    </md-input-container>
                                    <md-input-container flex="50">
                                        <label>Password</label>
                                        <input name="password"
                                               type="password"
                                               ng-model="$ctrl.loginData.password"
                                               required>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <span ng-show="!$ctrl.currentUser && $ctrl.loginAttempts > 0"
                                          layout="row" layout-align="center center"
                                          style="padding: 0 10px; color: red;">
                                        Invalid Credentials
                                    </span>
                                    <span flex></span>
                                    <md-button class="md-raised md-primary"
                                               ng-click="$ctrl.login()"
                                               ng-disabled="$ctrl.loginForm.$dirty && $ctrl.loginForm.$invalid">
                                        Login
                                    </md-button>
                                </div>
                            </form>
                        </md-tab>
                        <md-tab label="Signup">
                            <form name="$ctrl.signupForm">
                                <div layout="column" layout-align="center center">
                                    <md-input-container>
                                        <label>Username</label>
                                        <input name="username"
                                               type="text"
                                               ng-model="$ctrl.signupData.username"
                                               md-maxlength="20" required>
                                    </md-input-container>
                                    <md-input-container>
                                        <label>Email</label>
                                        <input name="email"
                                               type="text"
                                               ng-model="$ctrl.signupData.email"
                                               md-maxlength="40" required>
                                    </md-input-container>
                                    <md-input-container>
                                        <label>First Name</label>
                                        <input name="firstName"
                                               type="text"
                                               ng-model="$ctrl.signupData.firstName"
                                               md-maxlength="20" required>
                                    </md-input-container>
                                    <md-input-container>
                                        <label>Password</label>
                                        <input name="password"
                                               type="password"
                                               ng-model="$ctrl.signupData.password"
                                               md-maxlength="20" required>
                                    </md-input-container>
                                </div>
                                <div layout="row">
                                    <span flex></span>
                                    <md-button class="md-raised md-primary"
                                               ng-click="$ctrl.signup()"
                                               ng-disabled="$ctrl.signupForm.$dirty && $ctrl.signupForm.$invalid">
                                        Next
                                    </md-button>
                                </div>
                            </form>
                        </md-tab>
                    </md-tabs>
                    <md-progress-linear ng-if="$ctrl.isLoading" md-mode="indeterminate"></md-progress-linear>
                </md-card-content>
            </md-card>
        </div>
    </div>

    <!-- List View-->
    <div layout="row" layout-xs="column"
         ng-if="$ctrl.currentView.getValue() != 'login' && $ctrl.currentView.getValue() != 'signup'">
        <div flex="50">
            <md-card>
                <md-card-title>
                    <span class="md-headline">Your Recommendations</span>
                </md-card-title>
                <md-card-content>
                    <div layout="row" layout-align="space-around"
                         ng-if="$ctrl.isLoading">
                        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                    </div>

                    <div ng-if="!$ctrl.isLoading">
                        <!-- Anonymous User -->
                        <div ng-if="!$ctrl.currentUser"
                             class="empty-list">
                            <i class="material-icons">forum</i> <span>Login to view recommendations</span>
                        </div>
                        <!-- Empty List -->
                        <div ng-if="$ctrl.recommendationsList.length == 0 && $ctrl.currentUser"
                             class="empty-list">
                            <i class="material-icons">forum</i> <span>You have no recommendations</span>
                        </div>
                        <!-- Full List -->
                        <md-list>
                            <md-list-item class="md-3-line"
                                          ng-repeat="recommendation in $ctrl.recommendationsList"
                                          ng-click="null">
                                <img src="https://ssl.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png"
                                     class="md-avatar" />
                                <div class="md-list-item-text" layout="column">
                                    <h3>{{ recommendation.title }}</h3>
                                    <h4>{{ recommendation.firstName }}</h4>
                                    <p>{{ recommendation.message }}</p>
                                </div>
                            </md-list-item>
                        </md-list>
                    </div>
                </md-card-content>

                <md-card-actions layout="row" layout-align="end center">

                </md-card-actions>
            </md-card>

            <md-card>
                <md-card-title>
                    <span class="md-headline">New Recommendation</span>
                </md-card-title>
                <md-card-content layout="row">
                    <!-- Anonymous User -->
                    <div class="empty-list"
                         ng-if="!$ctrl.currentUser">
                        <i class="material-icons">account_circle</i> <span>Login to create recommendations</span>
                    </div>
                    <!-- Logged In User -->
                    <div flex layout="row"
                         ng-if="$ctrl.currentUser">
                        <div layout="column" flex="1" style="padding: 10px;">
                            <img src="https://ssl.gstatic.com/images/branding/product/1x/avatar_circle_blue_512dp.png"
                                 height="50" width="50"
                                 class="md-avatar" />
                        </div>
                        <div layout="column" flex="4" style="width: 100%">
                            <md-input-container>
                                <label>Media</label>
                                <md-select ng-model="$ctrl.newRecommendation.mediaID">
                                    <md-option ng-repeat="media in $ctrl.mediaList"
                                               ng-value="media.id">
                                        {{ media.title }}
                                    </md-option>
                                </md-select>
                            </md-input-container>

                            <md-input-container>
                                <label>For</label>
                                <md-select ng-model="$ctrl.newRecommendation.recommendedToID">
                                    <md-option ng-repeat="user in $ctrl.userList"
                                               ng-value="user.id">
                                        {{ user.firstName }} {{ user.lastName }} ({{ user.username }})
                                    </md-option>
                                </md-select>
                            </md-input-container>

                            <md-input-container>
                                <label>Message</label>
                                <textarea name="message"
                                       type="text"
                                       ng-model="$ctrl.newRecommendation.message"
                                       md-maxlength="500" required></textarea>
                            </md-input-container>
                        </div>
                    </div>
                </md-card-content>

                <md-card-actions layout="row" layout-align="end center">
                    <md-button class="md-primary"
                               ng-click="$ctrl.createRecommendation()">
                        Create
                    </md-button>
                </md-card-actions>
            </md-card>
        </div>

        <div flex="50">
            <md-card>
                <md-card-title>
                    <span class="md-headline">Media</span>
                    <span flex></span>
                    <md-button class="md-icon-button"
                               ng-click="$ctrl.refreshMediaList()">
                        <md-icon>refresh</md-icon>
                    </md-button>
                </md-card-title>
                <md-card-content>
                    <div layout="row" layout-align="space-around"
                         ng-if="$ctrl.isLoading">
                        <md-progress-circular md-mode="indeterminate"></md-progress-circular>
                    </div>

                    <md-grid-list md-cols="2" md-row-height="2:2"
                                  ng-if="!$ctrl.isLoading">
                        <md-grid-tile md-colspan="1" md-rowspan="1"
                                      class="media-tile {{ ::$ctrl.tileClass($index) }}"
                                      ng-repeat="media in $ctrl.mediaList track by $index">
                            <md-grid-tile-header>
                                <h3>{{ media.title }}</h3>
                            </md-grid-tile-header>

                            <p>{{ media.description }}</p>

                            <md-grid-tile-footer>
                                <md-button ng-click="$ctrl.recommendMedia(media)">Recommend</md-button>
                                <md-button ng-click="$ctrl.reviewMedia(media)">Review</md-button>
                            </md-grid-tile-footer>
                        </md-grid-tile>
                    </md-grid-list>
                </md-card-content>
            </md-card>
        </div>
    </div>
</md-content>
